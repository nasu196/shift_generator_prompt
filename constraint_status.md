# 制約テンプレート実装ステータス

このファイルは、シフト生成モデルで考慮される制約ルールとその実装状況、およびAIによるルール解釈実験の対象状況を管理します。

## 個人ルール

### ハード制約 (必ず守る)

| No. | ルール概要                     | テンプレート案                                                           | 実装状況 (shift_model.py) | AI実験対象? | 備考                                    |
|-----|--------------------------------|--------------------------------------------------------------------------|---------------------------|-------------|-----------------------------------------|
| 1   | 固定シフト (希望休/育休/病休)  | `ASSIGN(employee, date, shift)`                                          | ✅ 実装済み (制約#1, #2)     | ✅ 対象     | 希望休として入力                      |
| 2   | 禁止シフト                     | `FORBID_SHIFT(employee, shift)`                                          | ✅ 実装済み (制約#7内)      | ✅ 対象     | 「夜勤はできません」                      |
| 3   | 許可シフト限定                 | `ALLOW_ONLY_SHIFTS(employee, allowed_shifts)`                            | ✅ 実装済み (制約#10)     | ✅ 対象     | 「日勤と早出のみ可能」                  |
| 4   | 最大連続勤務日数               | `MAX_CONSECUTIVE_WORK(employee, max_days)`                               | ✅ 実装済み (制約#6)      | ✅ 対象     | 「連続勤務は4日まで」「最大3連勤まで」    |
| 5   | 最小/最大 合計シフト数         | `TOTAL_SHIFT_COUNT(employee, shifts, min, max)`                          | ✅ 実装済み (制約#8, #13) | ✅ 対象     | 「必ず公休を10日以上ください」          |
| 6   | 組み合わせNG                   | `FORBID_SIMULTANEOUS_SHIFT(employee1, employee2, shift)`                 | ✅ 実装済み (制約#9)      | ✅ 対象     | 「EMP004さんと同じ日の夜勤はNG」        |
| 7   | 最大連続公休数                 | `MAX_CONSECUTIVE_OFF(employee, max_days)`                                | ❌ 対象外   | (今回は入力例なし)                      |
| 8   | 土日祝休み                     | `WEEKEND_HOLIDAY_OFF(employee)`                                          | ✅ 実装済み (制約#15)     | ✅ 対象     | 「土日は休み希望」「土日祝日休み」        |
| 9   | シフトシーケンス禁止             | `FORBID_SHIFT_SEQUENCE(employee, preceding_shift, subsequent_shift)`       | ❌ 未実装                 | ❌ 対象外   |                                         |
| 10  | 特定日付の希望シフト(Hard)     | `ASSIGN(employee, date, shift)` (制約#1と同じ)                         | ✅ 実装済み (制約#7内)      | ✅ 対象     | 「5/5に早出希望」 (夜勤以外)            |

### ソフト制約 (できるだけ守る)

| No. | ルール概要                     | テンプレート案                                                           | 実装状況 (shift_model.py) | AI実験対象? | 備考                                    |
|-----|--------------------------------|--------------------------------------------------------------------------|---------------------------|-------------|-----------------------------------------|
| 1   | 曜日希望                       | `PREFER_WEEKDAY_SHIFT(employee, weekday, shift, weight)`                 | ✅ 実装済み (制約#11)     | ❌ 対象外   | (今回は入力例なし)                      |
| 2   | 特定パート合計公休日数目標       | `TARGET_TOTAL_OFF_DAYS(employee, target_count, weight)`                  | ✅ 実装済み (制約#17)     | ❌ 対象外   | (今回は入力例なし)                      |
| 3   | カレンダー勤務 (A/Bさん)       | `PREFER_CALENDAR_SCHEDULE(employee, weight)`                             | ✅ 実装済み (制約#12)     | ❌ 対象外   | (今回はA/Bは入力なし)                 |
| 4   | 特定日付の希望シフト(Soft)     | `PREFER_DATE_SHIFT(employee, date, shift, weight)`                       | ✅ 実装済み (制約#7内)      | ❌ 対象外   | (夜勤希望はソフトだが入力例なし)        |
| 5   | シフトシーケンス強制             | `PREFER_SHIFT_SEQUENCE(employee, preceding_shift, subsequent_shift, weight)` | ❌ 未実装                 | ❌ 対象外   |                                         |

## 施設全体ルール

(施設全体ルールは、現在の実験スコープではAIによる解釈対象外とし、OR-Toolsモデルに直接組み込む想定)

### ハード制約 (必ず守る)

| No. | ルール概要                     | テンプレート案                                                      | 実装状況 (shift_model.py) | AI実験対象? | 備考                                    |
|-----|--------------------------------|-----------------------------------------------------------------|---------------------------|-------------|-----------------------------------------|
| 1   | 人員配置基準（フロア別＆合計） | `MIN_STAFFING_FLOOR(...)`, `TOTAL_STAFFING_FACILITY(...)`       | ✅ 実装済み (制約#4)      | ❌ 対象外   | (固定値)                                |
| 2   | 夜勤ローテーション(夜→明, 明→公) | `ENFORCE_NIGHT_ROTATION(employee="ALL")`                          | ✅ 実装済み (制約#5)      | ❌ 対象外   | (固定ルール)                            |
| 3   | 特定役割の最低出勤             | `MIN_ROLE_ON_DUTY(role, min_count, date_type)`                  | ✅ 実装済み (制約#14)     | ❌ 対象外   | (固定ルール)                            |
| 4   | 最大連続公休数 (全体)          | `MAX_CONSECUTIVE_OFF(employee_group="ALL", max_days)`             | ❌ 未実装                 | ❌ 対象外   |                                         |
| 5   | シフトシーケンス禁止 (全体)      | `FORBID_SHIFT_SEQUENCE(employee="ALL", preceding, subsequent)`    | ❌ 未実装                 | ❌ 対象外   |                                         |

### ソフト制約 (できるだけ守る)

| No. | ルール概要              | テンプレート案                               | 実装状況 (shift_model.py) | AI実験対象? | 備考                                    |
|-----|-------------------------|----------------------------------------------|---------------------------|-------------|-----------------------------------------|
| 1   | 公休日数均等化          | `BALANCE_OFF_DAYS(employee_group, weight)`   | ✅ 実装済み (目的関数内)  | ❌ 対象外   | (固定ルール)                            |
| 2   | 応援勤務最小化          | `MINIMIZE_HELPING(weight)`                   | ✅ 実装済み (目的関数内)  | ❌ 対象外   | (固定ルール)                            |
| 3   | 明け人数≒前日夜勤人数  | `BALANCE_AKE_NIGHT_COUNT(weight)`            | ✅ 実装済み (制約#5b)     | ❌ 対象外   | (固定ルール)                            |
| 4   | シフトシーケンス強制 (全体) | `PREFER_SHIFT_SEQUENCE(employee="ALL", ...)` | ❌ 未実装                 | ❌ 対象外   |                                         |

## パース/モデル未反映のルール (CSVより)

*   AMさん: 「基本的に」水曜早出/木曜夜勤 のニュアンス
*   ANさん: 「月に2回程度は日曜勤務可」の頻度/例外ルール 