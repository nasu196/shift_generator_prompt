# 開発ToDoリスト

このリストは、シフト生成アプリケーション開発における今後のタスクと課題を管理します。

## フェーズ1: AIルール解釈 プロトタイピング (完了済み)

*   [x] **AIプロンプト詳細化:**
    *   [x] 対応する制約テンプレート（個人・施設）について、自然言語から構造化データ（JSON）と確認文を生成するプロンプトを具体化。
    *   [x] 様々な入力パターン（曖昧表現、複数ルール混在など）に対する挙動を定義・実験。
    *   [x] 解釈不能な場合の出力形式 (`UNPARSABLE`) を定義。
    *   [x] 対象年を指定して日付解釈の精度を向上させるよう修正。
    *   [-] 複雑なパターンルール（例: 5日間セット）の分解は現状AIには困難と判断。手動分解で対応する方針に。
*   [x] **ルールパーサー (`rule_parser.py`) の完成:**
    *   [x] AIが出力する個人ルール・施設ルールの構造化データ（JSON）をパースし、OR-Toolsモデル用のPython辞書リストに変換するロジックを実装。
    *   [x] データ検証ロジックを強化（必須パラメータ、型、日付範囲、シフト記号、グループ名など）。
    *   [x] 日付の年補完（年末年始、うるう年考慮）と期間検証を実装。
*   [x] **モデル構築 (`shift_model.py`) の修正:**
    *   [x] `is_hard` パラメータに基づき、主要な個人ルール・施設ルールでハード制約/ソフト制約の切り替えに対応。
    *   [x] `rule_parser.py` が生成した構造化ルールデータを処理し、対応する制約・目標をモデルに追加。
    *   [x] ハードコードされていた施設ルール（人員配置など）を削除し、動的処理に変更。
    *   [ ] ソフト制約の重み (`weight`) の処理は現在仮実装（整数化）。要改善。
*   [x] **メイン処理 (`shift_generator.py`) の修正:**
    *   [x] 個人・施設ルールそれぞれのAI呼び出し、パーサー呼び出し、モデル構築・求解・出力のパイプラインを実装。
    *   [x] AI整形シミュレーション部分を削除。
*   [x] **動作確認と評価:**
    *   [x] `rules.csv`, `facility_rules.txt` の内容で実行し、シフト生成と制約適用を確認。
    *   [x] AIによる解釈・構造化の精度限界（特に複雑なパターン）を確認。

## フェーズ2: 基本アプリケーション機能実装 (次フェーズ)

*   [ ] **データベース設計・実装:**
    *   [ ] 従業員情報、ルール（構造化データ）、シフト結果を格納するDBスキーマを確定し、マイグレーションを実装する。
    *   [ ] ORM (SQLAlchemyなど) を使った基本的なCRUD操作を実装する。
*   [ ] **バックエンドAPI実装:**
    *   [ ] 従業員情報、ルール設定のCRUD API。
    *   [ ] シフト生成リクエストAPI（非同期処理を検討）。
    *   [ ] 生成結果取得API。
*   [ ] **フロントエンド実装 (MVP):**
    *   [ ] 基本的な画面構成（ルール入力、シフト表示）。
    *   [ ] ルール入力UI（まずは構造化データ or テンプレート入力）。
    *   [ ] シフト表示グリッド。
    *   [ ] API連携。
*   [ ] **基本設定の外部入力:**
    *   [ ] シフト開始日、期間をコマンドライン引数や設定ファイルで指定できるようにする。

## フェーズ3: AI連携 本格実装 (次々フェーズ以降)

*   [ ] **自然言語ルール入力UI:**
    *   [ ] ユーザーがテキストエリアにルールを入力できるUI。
*   [ ] **AI API連携:**
    *   [ ] バックエンドからLLM APIを呼び出し、整形・構造化処理を実行するモジュールを実装。
    *   [ ] APIキー管理。
*   [ ] **ユーザー確認・承認フロー:**
    *   [ ] AIが生成した確認文と構造化データをUIに表示。
    *   [ ] ユーザーが内容を確認し、承認または修正指示（`is_hard` 調整含む）を行えるUIとバックエンドロジック。
*   [ ] **ルール永続化:**
    *   [ ] ユーザーが承認した構造化ルールをDBに保存する。

## フェーズ4: 機能拡張・改善 (将来)

*   [ ] **施設全体ルールのカスタマイズ:** (一部AI対応済みだが、UIからの設定変更など)
*   [ ] **OR-Toolsモデル改善:**
    *   [ ] ソフト制約の重み付け (`weight`) の処理を改善する。（フェーズ1からの残り）
    *   [ ] 応援勤務のより詳細なモデリング。
    *   [ ] ソフト制約の重み付けをユーザーが調整できる機能。
*   [ ] **UI/UX改善:**
    *   [ ] シフトの手動調整機能。
    *   [ ] 統計情報（個人別勤務日数、休日数など）の表示。
    *   [ ] 見た目の改善。
*   [ ] **エラーハンドリング強化:**
    *   [ ] `INFEASIBLE` 時の原因推定とユーザーへのフィードバック改善。
    *   [ ] AI解釈エラー時のより親切なガイド。

## その他

*   [ ] テストコードの実装（単体テスト、結合テスト）
*   [ ] ドキュメント整備（README更新、コードコメント）
*   [ ] デプロイ環境構築
*   [ ] ロギング・モニタリング
*   [ ] デバッグ用プリント文の整理・削除 