# 開発ToDoリスト

このリストは、シフト生成アプリケーション開発における今後のタスクと課題を管理します。

## フェーズ1: AIルール解釈 プロトタイピング (最優先)

*   [ ] **AIプロンプト詳細化:**
    *   [ ] 対応する制約テンプレート（`constraint_status.md` の ✅ 対象）について、自然言語から構造化データ（JSON）と確認文を生成するプロンプトを具体化する。
    *   [ ] 様々な入力パターン（曖昧表現、複数ルール混在など）に対する挙動を定義・実験する。
    *   [ ] 解釈不能な場合の出力形式を定義する。
*   [ ] **ルールパーサー (`rule_parser.py`) の完成:**
    *   [ ] AIが出力する（と仮定される）構造化データ（JSON）を正確にパースし、OR-Toolsモデル用のPython辞書リストに変換するロジックを完成させる。
    *   [ ] データ検証ロジックを強化する（必須パラメータチェック、型チェックなど）。
*   [ ] **モデル構築 (`shift_model.py`) の修正:**
    *   [ ] ソフト制約のペナルティ計算ロジックを、構造化ルールデータから得られる情報（`is_hard`, `weight` など）に基づいて動的に処理するように修正する。（現状は `employees_df` を直接見ている部分がある）
    *   [ ] `rule_parser.py` が生成した構造化ルールデータを正しく処理し、対応する制約・目標をモデルに追加するロジックを完成させる。
*   [ ] **メイン処理 (`shift_generator.py`) の修正:**
    *   [ ] AI整形シミュレーション部分を、定義したJSON形式の出力に合わせる。
    *   [ ] `build_shift_model` に渡す引数を最終化する。
*   [ ] **動作確認と評価:**
    *   [ ] `user_rules_input.csv` の内容を変えながら実行し、意図した制約が適用されているか、シフト結果が妥当かを確認する。
    *   [ ] AIによる解釈・構造化の精度限界を見極める。

## フェーズ2: 基本アプリケーション機能実装 (優先度: 高)

*   [ ] **データベース設計・実装:**
    *   [ ] 従業員情報、ルール（構造化データ）、シフト結果を格納するDBスキーマを確定し、マイグレーションを実装する。
    *   [ ] ORM (SQLAlchemyなど) を使った基本的なCRUD操作を実装する。
*   [ ] **バックエンドAPI実装:**
    *   [ ] 従業員情報、ルール設定のCRUD API。
    *   [ ] シフト生成リクエストAPI（非同期処理を検討）。
    *   [ ] 生成結果取得API。
*   [ ] **フロントエンド実装 (MVP):**
    *   [ ] 基本的な画面構成（ルール入力、シフト表示）。
    *   [ ] ルール入力UI（まずは構造化データ or テンプレート入力）。
    *   [ ] シフト表示グリッド。
    *   [ ] API連携。
*   [ ] **基本設定の外部入力:**
    *   [ ] シフト開始日、期間をコマンドライン引数や設定ファイルで指定できるようにする。

## フェーズ3: AI連携 本格実装 (優先度: 中)

*   [ ] **自然言語ルール入力UI:**
    *   [ ] ユーザーがテキストエリアにルールを入力できるUI。
*   [ ] **AI API連携:**
    *   [ ] バックエンドからLLM APIを呼び出し、整形・構造化処理を実行するモジュールを実装。
    *   [ ] APIキー管理。
*   [ ] **ユーザー確認・承認フロー:**
    *   [ ] AIが生成した確認文と構造化データをUIに表示。
    *   [ ] ユーザーが内容を確認し、承認または修正指示を行えるUIとバックエンドロジック。
*   [ ] **ルール永続化:**
    *   [ ] ユーザーが承認した構造化ルールをDBに保存する。

## フェーズ4: 機能拡張・改善 (優先度: 低～中)

*   [ ] **施設全体ルールのカスタマイズ:**
    *   [ ] 人員配置基準などを設定ファイルやUIから変更できるようにする。
    *   [ ] または、施設ルールも自然言語入力＋AI解釈に対応させる。
*   [ ] **OR-Toolsモデル改善:**
    *   [ ] 未実装の制約テンプレート（シフトシーケンス禁止/強制など）を追加。
    *   [ ] 応援勤務のより詳細なモデリング。
    *   [ ] ソフト制約の重み付けをユーザーが調整できる機能。
*   [ ] **UI/UX改善:**
    *   [ ] シフトの手動調整機能。
    *   [ ] 統計情報（個人別勤務日数、休日数など）の表示。
    *   [ ] 見た目の改善。
*   [ ] **エラーハンドリング強化:**
    *   [ ] `INFEASIBLE` 時の原因推定とユーザーへのフィードバック改善。
    *   [ ] AI解釈エラー時のより親切なガイド。

## その他

*   [ ] テストコードの実装（単体テスト、結合テスト）
*   [ ] ドキュメント整備（README更新、コードコメント）
*   [ ] デプロイ環境構築
*   [ ] ロギング・モニタリング 